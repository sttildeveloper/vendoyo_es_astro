---
/**
 * ScreenTeam.astro
 * Pantalla de gestión de usuarios/equipo con chips de filtro
 * Basado en admin_usuarios.png del diseño
 */
import { Icon } from 'astro-icon/components';
import MobileNavbar from './MobileNavbar.astro';
---

<div class="screen-container bg-slate-50 text-neutral-text">
  
  <!-- Header -->
  <div class="screen-header space-y-3">
    <div class="flex justify-between items-center">
      <h1 class="text-xl font-bold text-neutral-text">Usuarios</h1>
      <button class="w-8 h-8 rounded-full bg-brand-primary flex items-center justify-center text-white shadow-sm">
        <Icon name="heroicons:plus" class="w-5 h-5" />
      </button>
    </div>
    
    <!-- Search Bar -->
    <div class="relative">
      <Icon name="heroicons:magnifying-glass" class="w-4 h-4 text-neutral-muted absolute left-3 top-1/2 -translate-y-1/2" />
      <div class="w-full bg-white border border-neutral-border rounded-xl pl-9 pr-4 py-2.5 text-sm text-neutral-muted">
        Buscar usuario...
      </div>
    </div>

    <!-- Filter Chips -->
    <div class="flex gap-2 overflow-x-auto pb-1">
      <div class="chip chip-active flex-shrink-0">
        Todos
        <span class="bg-white/20 text-white text-[10px] px-1.5 py-0.5 rounded-full ml-1">24</span>
      </div>
      <div class="chip chip-default flex-shrink-0">
        Activos
        <span class="bg-neutral-border text-neutral-muted text-[10px] px-1.5 py-0.5 rounded-full ml-1">18</span>
      </div>
      <div class="chip chip-default flex-shrink-0">
        Pendientes
        <span class="bg-accent-warning/20 text-accent-warning text-[10px] px-1.5 py-0.5 rounded-full ml-1">3</span>
      </div>
      <div class="chip chip-default flex-shrink-0">
        Inactivos
      </div>
    </div>
  </div>

  <!-- Team List -->
  <div class="screen-content space-y-3" id="team-list">
    
    <!-- Team Member 1 -->
    <div class="team-card bg-white p-3 rounded-xl shadow-sm border border-neutral-border flex items-center gap-3">
      <div class="w-12 h-12 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center font-bold text-lg relative">
        A
        <div class="absolute bottom-0 right-0 w-3 h-3 bg-accent-success border-2 border-white rounded-full"></div>
      </div>
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-2">
          <h3 class="font-bold text-neutral-text text-sm truncate">Ana Martínez</h3>
          <span class="badge badge-critical text-[9px] py-0.5 px-2">Admin</span>
        </div>
        <p class="text-xs text-neutral-muted truncate">Agente Senior</p>
      </div>
      <div class="text-right flex-shrink-0">
        <div class="text-xs font-bold text-neutral-text">12</div>
        <div class="text-[10px] text-neutral-muted">Ventas</div>
      </div>
      <button class="p-2 hover:bg-slate-50 rounded-lg transition-colors text-neutral-muted">
        <Icon name="heroicons:ellipsis-vertical" class="w-5 h-5" />
      </button>
    </div>

    <!-- Team Member 2 -->
    <div class="team-card bg-white p-3 rounded-xl shadow-sm border border-neutral-border flex items-center gap-3">
      <div class="w-12 h-12 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-lg relative">
        C
        <div class="absolute bottom-0 right-0 w-3 h-3 bg-accent-success border-2 border-white rounded-full"></div>
      </div>
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-2">
          <h3 class="font-bold text-neutral-text text-sm truncate">Carlos Ruiz</h3>
          <span class="badge badge-info text-[9px] py-0.5 px-2">Agente</span>
        </div>
        <p class="text-xs text-neutral-muted truncate">Agente Comercial</p>
      </div>
      <div class="text-right flex-shrink-0">
        <div class="text-xs font-bold text-neutral-text">8</div>
        <div class="text-[10px] text-neutral-muted">Ventas</div>
      </div>
      <button class="p-2 hover:bg-slate-50 rounded-lg transition-colors text-neutral-muted">
        <Icon name="heroicons:ellipsis-vertical" class="w-5 h-5" />
      </button>
    </div>

    <!-- Team Member 3 -->
    <div class="team-card bg-white p-3 rounded-xl shadow-sm border border-neutral-border flex items-center gap-3">
      <div class="w-12 h-12 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center font-bold text-lg relative">
        L
      </div>
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-2">
          <h3 class="font-bold text-neutral-text text-sm truncate">Laura Gómez</h3>
          <span class="badge badge-success text-[9px] py-0.5 px-2">Manager</span>
        </div>
        <p class="text-xs text-neutral-muted truncate">Gestor Fincas</p>
      </div>
      <div class="text-right flex-shrink-0">
        <div class="text-xs font-bold text-neutral-text">15</div>
        <div class="text-[10px] text-neutral-muted">Ventas</div>
      </div>
      <button class="p-2 hover:bg-slate-50 rounded-lg transition-colors text-neutral-muted">
        <Icon name="heroicons:ellipsis-vertical" class="w-5 h-5" />
      </button>
    </div>

    <!-- Team Member 4 -->
    <div class="team-card bg-white p-3 rounded-xl shadow-sm border border-neutral-border flex items-center gap-3">
      <div class="w-12 h-12 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center font-bold text-lg relative">
        D
        <div class="absolute bottom-0 right-0 w-3 h-3 bg-accent-success border-2 border-white rounded-full"></div>
      </div>
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-2">
          <h3 class="font-bold text-neutral-text text-sm truncate">David Tech</h3>
          <span class="badge badge-warning text-[9px] py-0.5 px-2">Soporte</span>
        </div>
        <p class="text-xs text-neutral-muted truncate">Soporte Técnico</p>
      </div>
      <div class="text-right flex-shrink-0">
        <div class="text-xs font-bold text-neutral-text">0</div>
        <div class="text-[10px] text-neutral-muted">Ventas</div>
      </div>
      <button class="p-2 hover:bg-slate-50 rounded-lg transition-colors text-neutral-muted">
        <Icon name="heroicons:ellipsis-vertical" class="w-5 h-5" />
      </button>
    </div>

    <!-- Team Member 5 -->
    <div class="team-card bg-white p-3 rounded-xl shadow-sm border border-neutral-border flex items-center gap-3">
      <div class="w-12 h-12 rounded-full bg-pink-100 text-pink-600 flex items-center justify-center font-bold text-lg relative">
        S
      </div>
      <div class="flex-1 min-w-0">
        <div class="flex items-center gap-2">
          <h3 class="font-bold text-neutral-text text-sm truncate">Sofía López</h3>
          <span class="badge text-[9px] py-0.5 px-2 bg-slate-100 text-slate-600">Prácticas</span>
        </div>
        <p class="text-xs text-neutral-muted truncate">Becaria</p>
      </div>
      <div class="text-right flex-shrink-0">
        <div class="text-xs font-bold text-neutral-text">2</div>
        <div class="text-[10px] text-neutral-muted">Ventas</div>
      </div>
      <button class="p-2 hover:bg-slate-50 rounded-lg transition-colors text-neutral-muted">
        <Icon name="heroicons:ellipsis-vertical" class="w-5 h-5" />
      </button>
    </div>

  </div>

  <!-- Sync Toast -->
  <div class="p-4 flex justify-center pb-2">
    <div class="bg-neutral-text text-white text-xs font-bold px-4 py-2 rounded-full shadow-lg flex items-center gap-2" id="team-toast" style="opacity: 0; transform: translateY(20px);">
      <Icon name="heroicons:arrow-path" class="w-3 h-3 animate-spin" />
      <span>Sincronizando equipo...</span>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <MobileNavbar activeTab="users" variant="admin" />
</div>

<script>
  import gsap from 'gsap';

  declare global {
    interface Window {
      animateTeamScreen: () => gsap.core.Timeline;
    }
  }

  window.animateTeamScreen = () => {
    const tl = gsap.timeline();
    
    // Reset
    gsap.set('.team-card', { opacity: 0, y: 20 });
    gsap.set('#team-toast', { opacity: 0, y: 20 });

    // Staggered List Entry
    tl.to('.team-card', {
      opacity: 1,
      y: 0,
      duration: 0.5,
      stagger: 0.1,
      ease: "power2.out",
      delay: 0.2
    })
    
    // Toast appears
    .to('#team-toast', {
      opacity: 1,
      y: 0,
      duration: 0.4,
      ease: "back.out(1.7)"
    }, "-=0.2")

    // Toast changes to Success
    .to('#team-toast', {
      backgroundColor: '#10b981',
      width: 'auto',
      duration: 0.3,
      delay: 1.5,
      onStart: () => {
        const toast = document.getElementById('team-toast');
        if (toast) toast.innerHTML = '<svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" /></svg><span>Actualizado</span>';
      }
    })
    
    // Toast disappears
    .to('#team-toast', {
      opacity: 0,
      y: 20,
      duration: 0.5,
      delay: 1
    });

    return tl;
  }
</script>

---
import { Icon } from 'astro-icon/components';
---

<div class="bg-slate-50 h-full flex flex-col font-sans">
  <!-- Header -->
  <div class="bg-white pt-5 pb-3 px-5 shadow-sm z-10">
    <div class="flex justify-between items-center mb-4">
        <h1 class="text-xl font-bold text-slate-900">Equipo</h1>
        <button class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-600">
            <Icon name="heroicons:plus" class="w-5 h-5" />
        </button>
    </div>
    
    <!-- Search Bar -->
    <div class="relative">
        <Icon name="heroicons:magnifying-glass" class="w-4 h-4 text-slate-400 absolute left-3 top-1/2 -translate-y-1/2" />
        <input type="text" placeholder="Buscar agente..." class="w-full bg-slate-100 rounded-lg pl-9 pr-4 py-2 text-sm text-slate-700 outline-none focus:ring-2 focus:ring-primary-200 transition-all" />
    </div>
  </div>

  <!-- Team List -->
  <div class="flex-1 overflow-y-auto p-4 space-y-3" id="team-list">
    <!-- List Items will be generated via loop for easier animation targeting -->
    {
        [
            { name: "Ana Martínez", role: "Agente Senior", sales: "12", color: "bg-purple-100 text-purple-600", online: true },
            { name: "Carlos Ruiz", role: "Agente Comercial", sales: "8", color: "bg-blue-100 text-blue-600", online: true },
            { name: "Laura Gómez", role: "Gestor Fincas", sales: "15", color: "bg-emerald-100 text-emerald-600", online: false },
            { name: "David Tech", role: "Soporte", sales: "0", color: "bg-orange-100 text-orange-600", online: true },
            { name: "Sofía L.", role: "Prácticas", sales: "2", color: "bg-pink-100 text-pink-600", online: false },
        ].map((member, index) => (
            <div class="team-card bg-white p-3 rounded-xl shadow-sm border border-slate-100 flex items-center gap-3 opacity-0 translate-y-4">
                <div class={`w-12 h-12 rounded-full ${member.color} flex items-center justify-center font-bold text-lg relative`}>
                    {member.name.charAt(0)}
                    {member.online && <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"></div>}
                </div>
                <div class="flex-1 min-w-0">
                    <h3 class="font-bold text-slate-800 text-sm truncate">{member.name}</h3>
                    <p class="text-xs text-slate-500 truncate">{member.role}</p>
                </div>
                <div class="text-right">
                    <div class="text-xs font-bold text-slate-900">{member.sales}</div>
                    <div class="text-[10px] text-slate-400">Ventas</div>
                </div>
                <button class="p-2 hover:bg-slate-50 rounded-lg transition-colors text-slate-400">
                    <Icon name="heroicons:ellipsis-vertical" class="w-5 h-5" />
                </button>
            </div>
        ))
    }
  </div>

  <!-- Bottom Floating Action -->
  <div class="p-4 flex justify-center pb-6">
     <div class="bg-slate-900 text-white text-xs font-bold px-4 py-2 rounded-full shadow-lg flex items-center gap-2" id="team-toast" style="opacity: 0; transform: translateY(20px);">
        <Icon name="heroicons:arrow-path" class="w-3 h-3 animate-spin" />
        <span>Sincronizando equipo...</span>
     </div>
  </div>
</div>

<script>
  import gsap from 'gsap';

  window.animateTeamScreen = () => {
      const tl = gsap.timeline();
      
      // Reset
      gsap.set('.team-card', { opacity: 0, y: 20 });
      gsap.set('#team-toast', { opacity: 0, y: 20 });

      // Staggered List Entry
      tl.to('.team-card', {
          opacity: 1,
          y: 0,
          duration: 0.5,
          stagger: 0.1,
          ease: "power2.out",
          delay: 0.2
      })
      
      // Toast appears
      .to('#team-toast', {
          opacity: 1,
          y: 0,
          duration: 0.4,
          ease: "back.out(1.7)"
      }, "-=0.2")

      // Toast changes to Success
      .to('#team-toast', {
          backgroundColor: '#10b981',
          width: 'auto',
          duration: 0.3,
          delay: 1.5,
          onStart: () => {
             const toast = document.getElementById('team-toast');
             if(toast) toast.innerHTML = '<svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" /></svg><span>Actualizado</span>';
          }
      })
      
      // Toast disappears
      .to('#team-toast', {
          opacity: 0,
          y: 20,
          duration: 0.5,
          delay: 1
      });

      return tl;
  }
</script>
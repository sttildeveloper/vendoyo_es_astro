--- 
import { Icon } from 'astro-icon/components';
import ScreenUpload from './screens/ScreenUpload.astro';
import ScreenTeam from './screens/ScreenTeam.astro';
import ScreenManagerDashboard from './screens/ScreenManagerDashboard.astro';
---

<section id="app-showcase" class="section bg-gradient-to-br from-primary-50 to-cyan-50">
  <div
    class="max-w-6xl mx-auto"
    x-data="{ activeTab: 'upload', autoplay: true }"
    x-init="() => {
      // Trigger initial animation
      setTimeout(() => window.animateUploadScreen?.().play(), 500);

      // Autoplay Logic
      if (autoplay) {
        const interval = setInterval(() => {
          if (!autoplay) return clearInterval(interval);
          const tabs = ['upload', 'assign', 'track'];
          const currentIndex = tabs.indexOf(activeTab);
          activeTab = tabs[(currentIndex + 1) % tabs.length];
        }, 6000); // Slightly longer for animations to finish
      }
    }"
    x-effect="
      // Watch for tab changes to trigger animations
      if (activeTab === 'upload') setTimeout(() => window.animateUploadScreen?.().restart(), 100);
      if (activeTab === 'assign') setTimeout(() => window.animateTeamScreen?.().restart(), 100);
      // Manager Dashboard animates on mount via CSS/Internal script
    "
  >
    <!-- Header -->
    <div class="text-center mb-12">
      <span class="badge mb-4">
        <Icon name="heroicons:device-phone-mobile" class="w-4 h-4" />
        App M贸vil Disponible
      </span>
      <h2 class="text-4xl md:text-5xl font-bold text-slate-900 mb-4">
        Descarga la <span class="gradient-text">App VendoYo</span>
      </h2>
      <p class="text-xl text-slate-600 max-w-2xl mx-auto mb-6">
        Disponible para <strong>iOS</strong> y <strong>Android</strong>. Gestiona tus propiedades
        desde cualquier lugar.
      </p>

      <!-- Store Badges -->
      <div class="flex flex-wrap gap-4 justify-center mb-8">
        <a
          href="#ios"
          class="inline-flex items-center gap-2 px-6 py-3 bg-slate-900 text-white rounded-xl hover:bg-slate-800 transition-all hover:-translate-y-1 shadow-lg"
        >
          <Icon name="lucide:apple" class="w-6 h-6" />
          <div class="text-left">
            <div class="text-xs opacity-80">Desc谩rgalo en</div>
            <div class="text-sm font-bold">App Store</div>
          </div>
        </a>
        <a
          href="#android"
          class="inline-flex items-center gap-2 px-6 py-3 bg-slate-900 text-white rounded-xl hover:bg-slate-800 transition-all hover:-translate-y-1 shadow-lg"
        >
          <Icon name="lucide:play" class="w-6 h-6" />
          <div class="text-left">
            <div class="text-xs opacity-80">Disponible en</div>
            <div class="text-sm font-bold">Google Play</div>
          </div>
        </a>
      </div>
    </div>

    <!-- Tabs + Phone Mockup -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
      <!-- Tabs -->
      <div class="order-2 lg:order-1">
        <!-- Tab Buttons -->
        <div class="flex flex-col gap-4 mb-6">
          <button
            @click="activeTab = 'upload'; autoplay = false"
            :class="activeTab === 'upload' ? 'bg-primary-400 text-white shadow-primary' : 'bg-white text-slate-700 hover:bg-primary-50'"
            class="flex items-start gap-4 p-6 rounded-2xl border-2 transition-all text-left"
            :style="activeTab === 'upload' ? 'border-color: var(--color-primary-400)' : 'border-color: var(--color-gray-200)'"
          >
            <div
              class="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0"
              :class="activeTab === 'upload' ? 'bg-white/20' : 'bg-primary-100'"
            >
              <Icon
                name="heroicons:home"
                class="w-6 h-6"
                :class="activeTab === 'upload' ? 'text-white' : 'text-primary-600'"
              />
            </div>
            <div>
              <h3 class="text-lg font-bold mb-1"> Sube tu Propiedad</h3>
              <p class="text-sm opacity-90">
                A帽ade fotos, descripci贸n y precio en minutos directamente desde tu m贸vil
              </p>
            </div>
          </button>

          <button
            @click="activeTab = 'assign'; autoplay = false"
            :class="activeTab === 'assign' ? 'bg-primary-400 text-white shadow-primary' : 'bg-white text-slate-700 hover:bg-primary-50'"
            class="flex items-start gap-4 p-6 rounded-2xl border-2 transition-all text-left"
            :style="activeTab === 'assign' ? 'border-color: var(--color-primary-400)' : 'border-color: var(--color-gray-200)'"
          >
            <div
              class="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0"
              :class="activeTab === 'assign' ? 'bg-white/20' : 'bg-primary-100'"
            >
              <Icon
                name="heroicons:users"
                class="w-6 h-6"
                :class="activeTab === 'assign' ? 'text-white' : 'text-primary-600'"
              />
            </div>
            <div>
              <h3 class="text-lg font-bold mb-1"> Gesti贸n de Equipo</h3>
              <p class="text-sm opacity-90">
                Administra usuarios, asigna roles y gestiona tu red de agentes f谩cilmente
              </p>
            </div>
          </button>

          <button
            @click="activeTab = 'track'; autoplay = false"
            :class="activeTab === 'track' ? 'bg-primary-400 text-white shadow-primary' : 'bg-white text-slate-700 hover:bg-primary-50'"
            class="flex items-start gap-4 p-6 rounded-2xl border-2 transition-all text-left"
            :style="activeTab === 'track' ? 'border-color: var(--color-primary-400)' : 'border-color: var(--color-gray-200)'"
          >
            <div
              class="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0"
              :class="activeTab === 'track' ? 'bg-white/20' : 'bg-primary-100'"
            >
              <Icon
                name="heroicons:chart-bar"
                class="w-6 h-6"
                :class="activeTab === 'track' ? 'text-white' : 'text-primary-600'"
              />
            </div>
            <div>
              <h3 class="text-lg font-bold mb-1"> Manager Dashboard</h3>
              <p class="text-sm opacity-90">KPIs, gesti贸n de cartera y estado de franquicia</p>
            </div>
          </button>
        </div>

        <!-- Progress Indicator -->
        <div class="flex gap-2">
          <div class="h-1 flex-1 rounded-full bg-primary-200">
            <div
              class="h-full rounded-full bg-primary-500 transition-all duration-300"
              :style="`width: ${activeTab === 'upload' ? '100' : '0'}%`"
            >
            </div>
          </div>
          <div class="h-1 flex-1 rounded-full bg-primary-200">
            <div
              class="h-full rounded-full bg-primary-500 transition-all duration-300"
              :style="`width: ${activeTab === 'assign' ? '100' : '0'}%`"
            >
            </div>
          </div>
          <div class="h-1 flex-1 rounded-full bg-primary-200">
            <div
              class="h-full rounded-full bg-primary-500 transition-all duration-300"
              :style="`width: ${activeTab === 'track' ? '100' : '0'}%`"
            >
            </div>
          </div>
        </div>
      </div>

      <!-- Phone Mockup -->
      <div class="order-1 lg:order-2 flex justify-center">
        <div class="relative max-w-sm w-full">
          <!-- Glow -->
          <div
            class="absolute inset-0 bg-gradient-to-r from-primary-400 to-cyan-400 rounded-[3rem] blur-3xl opacity-20"
          >
          </div>

          <!-- Phone Frame -->
          <div class="relative bg-slate-900 rounded-[3rem] p-3 shadow-2xl">
            <!-- Notch -->
            <div
              class="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-7 bg-slate-900 rounded-b-3xl z-10"
            >
            </div>

            <!-- Screen Container -->
            <div class="relative bg-white rounded-[2.5rem] aspect-[9/19] overflow-hidden isolate">
              
              <!-- Screen 1: Upload -->
              <div 
                class="absolute inset-0 w-full h-full bg-white" 
                x-show="activeTab === 'upload'" 
                x-transition:enter="transition ease-out duration-300" 
                x-transition:enter-start="opacity-0 translate-x-10" 
                x-transition:enter-end="opacity-100 translate-x-0" 
                x-transition:leave="transition ease-in duration-300" 
                x-transition:leave-start="opacity-100 translate-x-0" 
                x-transition:leave-end="opacity-0 -translate-x-10"
              >
                  <ScreenUpload />
              </div>

              <!-- Screen 2: Team -->
              <div 
                class="absolute inset-0 w-full h-full bg-white" 
                x-show="activeTab === 'assign'"
                x-transition:enter="transition ease-out duration-300" 
                x-transition:enter-start="opacity-0 translate-x-10" 
                x-transition:enter-end="opacity-100 translate-x-0" 
                x-transition:leave="transition ease-in duration-300" 
                x-transition:leave-start="opacity-100 translate-x-0" 
                x-transition:leave-end="opacity-0 -translate-x-10"
                style="display: none;"
              >
                  <ScreenTeam />
              </div>

              <!-- Screen 3: Manager Dashboard -->
              <div 
                class="absolute inset-0 w-full h-full bg-white" 
                x-show="activeTab === 'track'"
                x-transition:enter="transition ease-out duration-300" 
                x-transition:enter-start="opacity-0 translate-x-10" 
                x-transition:enter-end="opacity-100 translate-x-0" 
                x-transition:leave="transition ease-in duration-300" 
                x-transition:leave-start="opacity-100 translate-x-0" 
                x-transition:leave-end="opacity-0 -translate-x-10"
                style="display: none;"
              >
                  <ScreenManagerDashboard />
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Platform Logos -->
    <div class="mt-16 text-center">
      <p class="text-sm text-slate-500 mb-4">Compatible con</p>
      <div class="flex items-center justify-center gap-8 opacity-60">
        <div class="flex items-center gap-2">
          <Icon name="lucide:apple" class="w-8 h-8" />
          <span class="font-medium">iOS 14+</span>
        </div>
        <div class="flex items-center gap-2">
          <Icon name="lucide:smartphone" class="w-8 h-8" />
          <span class="font-medium">Android 8+</span>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  import autoAnimate from '@formkit/auto-animate';

  document.addEventListener('alpine:init', () => {
    // Auto-animate for smooth height changes if needed, 
    // though here we rely mostly on x-transition and GSAP
    const tabs = document.querySelectorAll('[x-show]');
    tabs.forEach((tab) => {
      if (tab.parentElement) {
        autoAnimate(tab.parentElement);
      }
    });
  });
</script>

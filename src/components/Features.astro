---
/**
 * Features.astro
 * Sección de características con 6 subsecciones alternando layout
 * Cada subsección tiene demo interactivo con animación GSAP ScrollTrigger en bucle infinito
 */
import { Icon } from 'astro-icon/components';
import DemoUploadProperty from './demos/DemoUploadProperty.astro';
import DemoWorkflow from './demos/DemoWorkflow.astro';
import DemoCRM from './demos/DemoCRM.astro';
import DemoAssignFranchise from './demos/DemoAssignFranchise.astro';
import DemoDashboard from './demos/DemoDashboard.astro';
import DemoAlertSystem from './demos/DemoAlertSystem.astro';
---

<section id="features" class="section bg-white">
  <div class="max-w-4xl mx-auto mb-20 text-center" data-features-header>
    <span class="badge mb-4">
      <Icon name="heroicons:sparkles" class="w-4 h-4" />
      Características
    </span>
    <h2 class="text-4xl md:text-5xl font-bold text-neutral-text mb-4">
      Todo lo que necesitas en <span class="gradient-text">una app</span>
    </h2>
    <p class="text-xl text-neutral-muted max-w-2xl mx-auto leading-relaxed">
      Gestiona tu negocio inmobiliario de forma profesional y sencilla con herramientas diseñadas para el mundo real.
    </p>
  </div>

  <div class="max-w-5xl mx-auto space-y-32">
    
    <!-- Feature 1: Gestión de Propiedades -->
    <div class="grid md:grid-cols-2 gap-8 lg:gap-12 items-center feature-block">
      <div class="space-y-6">
        <div class="inline-block px-3 py-1 bg-brand-primary-soft text-brand-primary text-xs font-bold rounded-full uppercase tracking-wider">
          Gestión Ágil
        </div>
        <h3 class="text-3xl md:text-4xl font-bold text-neutral-text leading-tight">
          Sube tu propiedad <br>
          <span class="text-brand-primary">en segundos.</span>
        </h3>
        <p class="text-neutral-muted text-lg leading-relaxed">
          Añade propiedades fácilmente con fotos, descripción y precio. Todo optimizado para hacerlo desde tu móvil.
        </p>
        <ul class="space-y-2">
          <li class="flex items-center gap-2 text-neutral-text text-sm">
            <Icon name="heroicons:check-circle" class="w-5 h-5 text-brand-primary flex-shrink-0" />
            Fotos optimizadas automáticamente
          </li>
          <li class="flex items-center gap-2 text-neutral-text text-sm">
            <Icon name="heroicons:check-circle" class="w-5 h-5 text-brand-primary flex-shrink-0" />
            Documentos y tareas asociadas
          </li>
          <li class="flex items-center gap-2 text-neutral-text text-sm">
            <Icon name="heroicons:check-circle" class="w-5 h-5 text-brand-primary flex-shrink-0" />
            Vista lista y detalle
          </li>
        </ul>
      </div>
      <div class="relative" data-demo="upload">
        <DemoUploadProperty />
      </div>
    </div>

    <!-- Feature 2: Trámites con Workflow -->
    <div class="grid md:grid-cols-2 gap-8 lg:gap-12 items-center feature-block">
      <div class="order-2 md:order-1 relative" data-demo="workflow">
        <DemoWorkflow />
      </div>
      <div class="space-y-6 order-1 md:order-2">
        <div class="inline-block px-3 py-1 bg-purple-50 text-purple-600 text-xs font-bold rounded-full uppercase tracking-wider">
          Operaciones
        </div>
        <h3 class="text-3xl md:text-4xl font-bold text-neutral-text leading-tight">
          Trámites con <br>
          <span class="text-purple-600">workflow completo.</span>
        </h3>
        <p class="text-neutral-muted text-lg leading-relaxed">
          Gestiona trámites paso a paso con estados, prioridades y adjuntos. Nunca pierdas el hilo de una operación.
        </p>
        <ul class="space-y-2">
          <li class="flex items-center gap-2 text-neutral-text text-sm">
            <Icon name="heroicons:check-circle" class="w-5 h-5 text-purple-600 flex-shrink-0" />
            Estados visuales por paso
          </li>
          <li class="flex items-center gap-2 text-neutral-text text-sm">
            <Icon name="heroicons:check-circle" class="w-5 h-5 text-purple-600 flex-shrink-0" />
            Prioridad y categorías
          </li>
          <li class="flex items-center gap-2 text-neutral-text text-sm">
            <Icon name="heroicons:check-circle" class="w-5 h-5 text-purple-600 flex-shrink-0" />
            Adjuntar documentos
          </li>
        </ul>
      </div>
    </div>

    <!-- Feature 3: CRM de Clientes -->
    <div class="grid md:grid-cols-2 gap-8 lg:gap-12 items-center feature-block">
      <div class="space-y-6">
        <div class="inline-block px-3 py-1 bg-amber-50 text-amber-600 text-xs font-bold rounded-full uppercase tracking-wider">
          Relaciones
        </div>
        <h3 class="text-3xl md:text-4xl font-bold text-neutral-text leading-tight">
          CRM de clientes <br>
          <span class="text-amber-600">integrado.</span>
        </h3>
        <p class="text-neutral-muted text-lg leading-relaxed">
          Mantén toda la información de tus clientes organizada. Búsqueda rápida, etiquetas y ficha completa.
        </p>
        <ul class="space-y-2">
          <li class="flex items-center gap-2 text-neutral-text text-sm">
            <Icon name="heroicons:check-circle" class="w-5 h-5 text-amber-600 flex-shrink-0" />
            Búsqueda instantánea
          </li>
          <li class="flex items-center gap-2 text-neutral-text text-sm">
            <Icon name="heroicons:check-circle" class="w-5 h-5 text-amber-600 flex-shrink-0" />
            Tags y categorización
          </li>
          <li class="flex items-center gap-2 text-neutral-text text-sm">
            <Icon name="heroicons:check-circle" class="w-5 h-5 text-amber-600 flex-shrink-0" />
            Historial de interacciones
          </li>
        </ul>
      </div>
      <div class="relative" data-demo="crm">
        <DemoCRM />
      </div>
    </div>

    <!-- Feature 4: Franquicias Multitenant -->
    <div class="grid md:grid-cols-2 gap-8 lg:gap-12 items-center feature-block">
      <div class="order-2 md:order-1 relative" data-demo="assign">
        <DemoAssignFranchise />
      </div>
      <div class="space-y-6 order-1 md:order-2">
        <div class="inline-block px-3 py-1 bg-blue-50 text-blue-600 text-xs font-bold rounded-full uppercase tracking-wider">
          Red de Franquicias
        </div>
        <h3 class="text-3xl md:text-4xl font-bold text-neutral-text leading-tight">
          Asigna y conecta <br>
          <span class="text-blue-600">tu red local.</span>
        </h3>
        <p class="text-neutral-muted text-lg leading-relaxed">
          Conecta con agencias locales y gestiona múltiples franquicias desde una sola app centralizada.
        </p>
        <ul class="space-y-2">
          <li class="flex items-center gap-2 text-neutral-text text-sm">
            <Icon name="heroicons:check-circle" class="w-5 h-5 text-blue-600 flex-shrink-0" />
            Filtro por comunidad
          </li>
          <li class="flex items-center gap-2 text-neutral-text text-sm">
            <Icon name="heroicons:check-circle" class="w-5 h-5 text-blue-600 flex-shrink-0" />
            Selección de tenant
          </li>
          <li class="flex items-center gap-2 text-neutral-text text-sm">
            <Icon name="heroicons:check-circle" class="w-5 h-5 text-blue-600 flex-shrink-0" />
            Métricas por agencia
          </li>
        </ul>
      </div>
    </div>

    <!-- Feature 5: Dashboard y Reportes -->
    <div class="grid md:grid-cols-2 gap-8 lg:gap-12 items-center feature-block">
      <div class="space-y-6">
        <div class="inline-block px-3 py-1 bg-emerald-50 text-emerald-600 text-xs font-bold rounded-full uppercase tracking-wider">
          Analítica
        </div>
        <h3 class="text-3xl md:text-4xl font-bold text-neutral-text leading-tight">
          Dashboard con <br>
          <span class="text-emerald-600">métricas en vivo.</span>
        </h3>
        <p class="text-neutral-muted text-lg leading-relaxed">
          Visualiza el rendimiento de tu red en tiempo real. Contadores, gráficas y exportación CSV.
        </p>
        <ul class="space-y-2">
          <li class="flex items-center gap-2 text-neutral-text text-sm">
            <Icon name="heroicons:check-circle" class="w-5 h-5 text-emerald-600 flex-shrink-0" />
            Contadores animados
          </li>
          <li class="flex items-center gap-2 text-neutral-text text-sm">
            <Icon name="heroicons:check-circle" class="w-5 h-5 text-emerald-600 flex-shrink-0" />
            Gráfica de tendencias
          </li>
          <li class="flex items-center gap-2 text-neutral-text text-sm">
            <Icon name="heroicons:check-circle" class="w-5 h-5 text-emerald-600 flex-shrink-0" />
            Exportar a CSV
          </li>
        </ul>
      </div>
      <div class="relative" data-demo="dashboard">
        <DemoDashboard />
      </div>
    </div>

    <!-- Feature 6: Alertas Segmentadas -->
    <div class="grid md:grid-cols-2 gap-8 lg:gap-12 items-center feature-block">
      <div class="order-2 md:order-1 relative" data-demo="alerts">
        <DemoAlertSystem />
      </div>
      <div class="space-y-6 order-1 md:order-2">
        <div class="inline-block px-3 py-1 bg-red-50 text-danger text-xs font-bold rounded-full uppercase tracking-wider">
          Comunicación
        </div>
        <h3 class="text-3xl md:text-4xl font-bold text-neutral-text leading-tight">
          Alertas <br>
          <span class="text-danger">segmentadas.</span>
        </h3>
        <p class="text-neutral-muted text-lg leading-relaxed">
          Comunica cambios importantes a toda tu red o solo a segmentos específicos. Filtra por comunidad, tenant o rol.
        </p>
        <ul class="space-y-2">
          <li class="flex items-center gap-2 text-neutral-text text-sm">
            <Icon name="heroicons:check-circle" class="w-5 h-5 text-danger flex-shrink-0" />
            Filtro por comunidad
          </li>
          <li class="flex items-center gap-2 text-neutral-text text-sm">
            <Icon name="heroicons:check-circle" class="w-5 h-5 text-danger flex-shrink-0" />
            Selección de destinatarios
          </li>
          <li class="flex items-center gap-2 text-neutral-text text-sm">
            <Icon name="heroicons:check-circle" class="w-5 h-5 text-danger flex-shrink-0" />
            Notificación instantánea
          </li>
        </ul>
      </div>
    </div>

  </div>
</section>

<script>
  import gsap from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';
  import { TextPlugin } from 'gsap/TextPlugin';
  import { ScrollToPlugin } from 'gsap/ScrollToPlugin';

  gsap.registerPlugin(ScrollTrigger, TextPlugin, ScrollToPlugin);

  const isReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  if (!isReduced) {
    
    // =====================
    // 1. UPLOAD DEMO (existing - keeps working)
    // =====================
    let uploadTL: gsap.core.Timeline;
    
    function resetUploadDemo() {
      const scrollContainer = document.getElementById('demo-upload-scroll');
      if (scrollContainer) scrollContainer.scrollTop = 0;
      
      gsap.set('.demo-step', { y: 20, opacity: 0 });
      gsap.set('#demo-upload-image', { opacity: 0, scale: 1.1 });
      gsap.set('#demo-upload-placeholder', { opacity: 1 });
      gsap.set('#demo-title-text', { text: "" });
      gsap.set('#demo-desc-text', { text: "" });
      gsap.set('#demo-cursor-title', { opacity: 1 });
      gsap.set('#demo-screen-form', { xPercent: 0, opacity: 1 });
      gsap.set('#demo-screen-list', { xPercent: 100, opacity: 0 });
      gsap.set('#demo-list-item-new', { opacity: 0, y: 20 });
      gsap.set('#demo-dot-1', { backgroundColor: '#0B8F7A' });
      gsap.set('#demo-dot-2', { backgroundColor: '#E2E8F0' });
      gsap.set('#demo-header-title', { text: "Nueva Propiedad" });
      gsap.set('#demo-save-btn', { backgroundColor: '#0B8F7A' });
    }

    function playUploadDemo() {
      resetUploadDemo();
      const scrollContainer = document.getElementById('demo-upload-scroll');
      
      uploadTL = gsap.timeline({ 
        repeat: -1, 
        repeatDelay: 3,
        onRepeat: resetUploadDemo
      });

      uploadTL.fromTo('.demo-step', 
        { y: 20, opacity: 0 },
        { y: 0, opacity: 1, duration: 0.5, stagger: 0.2, ease: "back.out(1.2)" }
      )
      .to('#demo-upload-image', { opacity: 1, scale: 1, duration: 0.8, ease: "power2.out" }, "+=0.3")
      .to('#demo-upload-placeholder', { opacity: 0, duration: 0.3 }, "<")
      .to(scrollContainer, { scrollTo: { y: 120 }, duration: 1, ease: "power2.inOut" }, "+=0.5")
      .to('#demo-title-text', { text: "Ático con Terraza", duration: 1.5, ease: "none" }, "+=0.3")
      .to('#demo-cursor-title', { opacity: 0, duration: 0.1 }, "+=0.1")
      .to(scrollContainer, { scrollTo: { y: "max" }, duration: 1, ease: "power2.inOut" }, "+=0.5")
      .to('#demo-desc-text', { text: "Espectacular ático reformado en el centro.", duration: 2, ease: "none" }, "+=0.3")
      .to('#demo-save-btn', { scale: 0.95, backgroundColor: '#087563', duration: 0.2, yoyo: true, repeat: 1 }, "+=0.8")
      .to('#demo-screen-form', { xPercent: -100, opacity: 0, duration: 0.8, ease: "power2.inOut" }, "+=1")
      .fromTo('#demo-screen-list', 
          { xPercent: 100, opacity: 1, zIndex: 30 },
          { xPercent: 0, duration: 0.8, ease: "power2.inOut" },
          "<"
      )
      .to('#demo-dot-1', { backgroundColor: '#E2E8F0', duration: 0.3 }, "<")
      .to('#demo-dot-2', { backgroundColor: '#0B8F7A', duration: 0.3 }, "<")
      .to('#demo-header-title', { text: "Mis Propiedades", duration: 0.5 }, "<")
      .to('#demo-list-item-new', { opacity: 1, y: 0, duration: 0.6, ease: "back.out(1.7)" }, "-=0.2");
    }

    ScrollTrigger.create({
      trigger: '[data-demo="upload"]',
      start: 'top 80%',
      onEnter: playUploadDemo,
      onLeaveBack: () => uploadTL?.kill()
    });

    // =====================
    // 2. WORKFLOW DEMO
    // =====================
    let workflowTL: gsap.core.Timeline;

    function resetWorkflowDemo() {
      gsap.set('#wf-step-1', { opacity: 1, x: 0 });
      gsap.set('#wf-step-2', { opacity: 0, x: '100%' });
      gsap.set('#wf-step-3', { opacity: 0, x: '100%' });
      gsap.set('#wf-success', { opacity: 0 });
      gsap.set('#wf-title-text', { text: "" });
      gsap.set('#wf-desc-text', { text: "" });
      gsap.set('#wf-cursor-1', { opacity: 1 });
      gsap.set('#wf-uploaded-file', { opacity: 0 });
      gsap.set('#wf-dot-1', { backgroundColor: '#0B8F7A' });
      gsap.set('#wf-dot-2', { backgroundColor: '#E2E8F0' });
      gsap.set('#wf-dot-3', { backgroundColor: '#E2E8F0' });
    }

    function playWorkflowDemo() {
      resetWorkflowDemo();
      
      workflowTL = gsap.timeline({ 
        repeat: -1, 
        repeatDelay: 3,
        onRepeat: resetWorkflowDemo
      });

      workflowTL
        // Step 1: Type title
        .to('#wf-title-text', { text: "Solicitud hipoteca", duration: 1.5, ease: "none" }, "+=0.5")
        .to('#wf-cursor-1', { opacity: 0, duration: 0.1 })
        .to('#wf-desc-text', { text: "Cliente requiere financiación", duration: 1.2, ease: "none" }, "+=0.3")
        // Transition to Step 2
        .to('#wf-step-1', { x: '-100%', opacity: 0, duration: 0.5, ease: "power2.inOut" }, "+=0.8")
        .to('#wf-step-2', { x: 0, opacity: 1, duration: 0.5, ease: "power2.inOut" }, "<")
        .to('#wf-dot-1', { backgroundColor: '#10B981', duration: 0.3 }, "<")
        .to('#wf-dot-2', { backgroundColor: '#0B8F7A', duration: 0.3 }, "<")
        // Select client
        .to('#wf-client-2', { scale: 0.98, duration: 0.1, yoyo: true, repeat: 1 }, "+=0.8")
        // Transition to Step 3
        .to('#wf-step-2', { x: '-100%', opacity: 0, duration: 0.5, ease: "power2.inOut" }, "+=0.8")
        .to('#wf-step-3', { x: 0, opacity: 1, duration: 0.5, ease: "power2.inOut" }, "<")
        .to('#wf-dot-2', { backgroundColor: '#10B981', duration: 0.3 }, "<")
        .to('#wf-dot-3', { backgroundColor: '#0B8F7A', duration: 0.3 }, "<")
        // Upload file
        .to('#wf-upload-area', { borderColor: '#0B8F7A', backgroundColor: '#DDF3EE', duration: 0.3 }, "+=0.5")
        .to('#wf-uploaded-file', { opacity: 1, duration: 0.5, ease: "back.out(1.5)" }, "+=0.3")
        // Save
        .to('#wf-btn-save', { scale: 0.95, duration: 0.1, yoyo: true, repeat: 1 }, "+=0.5")
        // Success
        .to('#wf-step-3', { opacity: 0, duration: 0.3 }, "+=0.3")
        .to('#wf-success', { opacity: 1, duration: 0.5 }, "<0.1");
    }

    ScrollTrigger.create({
      trigger: '[data-demo="workflow"]',
      start: 'top 80%',
      onEnter: playWorkflowDemo,
      onLeaveBack: () => workflowTL?.kill()
    });

    // =====================
    // 3. CRM DEMO
    // =====================
    let crmTL: gsap.core.Timeline;

    function resetCRMDemo() {
      gsap.set('#crm-list', { opacity: 1, x: 0 });
      gsap.set('#crm-detail', { opacity: 0, x: '100%' });
      gsap.set('#crm-search-text', { text: "" });
      gsap.set('#crm-cursor', { opacity: 1 });
      gsap.set('#crm-item-2', { backgroundColor: 'white', borderColor: '#0B8F7A' });
      gsap.set('.crm-tag', { scale: 0 });
    }

    function playCRMDemo() {
      resetCRMDemo();
      
      crmTL = gsap.timeline({ 
        repeat: -1, 
        repeatDelay: 3,
        onRepeat: resetCRMDemo
      });

      crmTL
        // Search typing
        .to('#crm-search-text', { text: "García", duration: 1, ease: "none" }, "+=0.5")
        .to('#crm-cursor', { opacity: 0, duration: 0.1 })
        // Highlight result
        .to('#crm-item-1', { opacity: 0.3, duration: 0.3 }, "+=0.3")
        .to('#crm-item-3', { opacity: 0.3, duration: 0.3 }, "<")
        .to('#crm-item-2', { scale: 1.02, duration: 0.2, yoyo: true, repeat: 1 }, "+=0.5")
        // Transition to detail
        .to('#crm-list', { x: '-100%', opacity: 0, duration: 0.5, ease: "power2.inOut" }, "+=0.5")
        .to('#crm-detail', { x: 0, opacity: 1, duration: 0.5, ease: "power2.inOut" }, "<")
        // Tags appear
        .to('.crm-tag', { scale: 1, duration: 0.3, stagger: 0.1, ease: "back.out(2)" }, "+=0.3");
    }

    ScrollTrigger.create({
      trigger: '[data-demo="crm"]',
      start: 'top 80%',
      onEnter: playCRMDemo,
      onLeaveBack: () => crmTL?.kill()
    });

    // =====================
    // 4. ASSIGN DEMO
    // =====================
    let assignTL: gsap.core.Timeline;

    function resetAssignDemo() {
      gsap.set('#assign-dropdown', { opacity: 0, maxHeight: 0, scale: 0.95 });
      gsap.set('#assign-community-text', { text: "Seleccionar comunidad..." });
      gsap.set('#assign-tenant-section', { opacity: 0, y: 10 });
      gsap.set('#assign-results', { opacity: 0, y: 10 });
    }

    function playAssignDemo() {
      resetAssignDemo();
      
      assignTL = gsap.timeline({ 
        repeat: -1, 
        repeatDelay: 3,
        onRepeat: resetAssignDemo
      });

      assignTL
        // Open dropdown
        .to('#assign-dropdown', { opacity: 1, maxHeight: 150, scale: 1, duration: 0.3, ease: "power2.out" }, "+=0.5")
        // Hover effect on Valencia
        .to('#assign-opt-2', { backgroundColor: '#C6EDE5', duration: 0.2 }, "+=0.5")
        // Select Valencia
        .to('#assign-dropdown', { opacity: 0, maxHeight: 0, scale: 0.95, duration: 0.3 }, "+=0.3")
        .set('#assign-community-text', { text: "Valencia", color: '#0B8F7A', fontWeight: 'bold' })
        // Show tenant filter
        .to('#assign-tenant-section', { opacity: 1, y: 0, duration: 0.4, ease: "back.out(1.5)" }, "+=0.3")
        // Select tenant chip
        .to('#assign-tenant-2', { scale: 0.95, duration: 0.1, yoyo: true, repeat: 1 }, "+=0.5")
        // Show results
        .to('#assign-results', { opacity: 1, y: 0, duration: 0.5, ease: "back.out(1.5)" }, "+=0.3");
    }

    ScrollTrigger.create({
      trigger: '[data-demo="assign"]',
      start: 'top 80%',
      onEnter: playAssignDemo,
      onLeaveBack: () => assignTL?.kill()
    });

    // =====================
    // 5. DASHBOARD DEMO
    // =====================
    let dashboardTL: gsap.core.Timeline;

    function resetDashboardDemo() {
      gsap.set('#dash-counter-1', { textContent: '0' });
      gsap.set('#dash-counter-2', { textContent: '0' });
      gsap.set('#dash-line-1', { attr: { d: "M0,50 L40,50 L80,50 L120,50 L160,50 L200,50" } });
      gsap.set('#dash-line-2', { attr: { d: "M0,50 L40,50 L80,50 L120,50 L160,50 L200,50" } });
      gsap.set('#dash-area', { attr: { d: "M0,55 L0,55 L40,55 L80,55 L120,55 L160,55 L200,55 L200,55 L0,55" } });
      gsap.set('#dash-export-toast', { opacity: 0, y: 10 });
      gsap.set('#dash-export-btn', { backgroundColor: 'white' });
    }

    function playDashboardDemo() {
      resetDashboardDemo();
      
      dashboardTL = gsap.timeline({ 
        repeat: -1, 
        repeatDelay: 3,
        onRepeat: resetDashboardDemo
      });

      dashboardTL
        // Count up
        .to('#dash-counter-1', { textContent: 124, duration: 1.5, snap: { textContent: 1 } }, "+=0.3")
        .to('#dash-counter-2', { textContent: 47, duration: 1.2, snap: { textContent: 1 } }, "<0.2")
        // Animate chart lines
        .to('#dash-line-1', { attr: { d: "M0,45 L40,35 L80,40 L120,25 L160,30 L200,15" }, duration: 1.2, ease: "power2.out" }, "-=0.5")
        .to('#dash-line-2', { attr: { d: "M0,48 L40,42 L80,45 L120,35 L160,38 L200,28" }, duration: 1.2, ease: "power2.out" }, "<")
        .to('#dash-area', { attr: { d: "M0,55 L0,45 L40,35 L80,40 L120,25 L160,30 L200,15 L200,55 L0,55" }, duration: 1.2, ease: "power2.out" }, "<")
        // Export button click
        .to('#dash-export-btn', { scale: 0.95, duration: 0.1, yoyo: true, repeat: 1 }, "+=0.8")
        .to('#dash-export-btn', { backgroundColor: '#DDF3EE', borderColor: '#0B8F7A', duration: 0.3 })
        // Show toast
        .to('#dash-export-toast', { opacity: 1, y: 0, duration: 0.4, ease: "back.out(1.5)" }, "+=0.2")
        .to('#dash-export-toast', { opacity: 0, duration: 0.3 }, "+=2");
    }

    ScrollTrigger.create({
      trigger: '[data-demo="dashboard"]',
      start: 'top 80%',
      onEnter: playDashboardDemo,
      onLeaveBack: () => dashboardTL?.kill()
    });

    // =====================
    // 6. ALERTS DEMO
    // =====================
    let alertsTL: gsap.core.Timeline;

    function resetAlertsDemo() {
      gsap.set('#alert-msg-text', { text: "" });
      gsap.set('#alert-cursor', { opacity: 1 });
      gsap.set('#alert-count', { textContent: '24' });
      gsap.set('#alert-priority', { opacity: 0 });
      gsap.set('#alert-send-btn', { backgroundColor: '#DC2626', scale: 1 });
      gsap.set('#alert-btn-text', { text: "Enviar Alerta" });
      gsap.set('#alert-notification', { opacity: 0, y: 20 });
      gsap.set('[data-chip="valencia"]', { backgroundColor: 'white', borderColor: '#E5E7EB', color: '#64748B' });
    }

    function playAlertsDemo() {
      resetAlertsDemo();
      
      alertsTL = gsap.timeline({ 
        repeat: -1, 
        repeatDelay: 3,
        onRepeat: resetAlertsDemo
      });

      alertsTL
        // Select Valencia chip
        .to('[data-chip="valencia"]', { 
          backgroundColor: '#DDF3EE', 
          borderColor: '#0B8F7A',
          color: '#0B8F7A',
          duration: 0.3 
        }, "+=0.5")
        // Update count
        .to('#alert-count', { textContent: 38, duration: 0.5, snap: { textContent: 1 } })
        // Type message
        .to('#alert-msg-text', { text: "Nuevas tarifas vigentes desde el lunes", duration: 2, ease: "none" }, "+=0.3")
        .to('#alert-cursor', { opacity: 0, duration: 0.2 })
        // Show priority
        .to('#alert-priority', { opacity: 1, duration: 0.3 }, "+=0.2")
        // Button press
        .to('#alert-send-btn', { scale: 0.95, duration: 0.1 }, "+=0.5")
        .to('#alert-send-btn', { scale: 1, backgroundColor: '#087563', duration: 0.2 })
        .to('#alert-btn-text', { text: "Enviando...", duration: 0.1 }, "<")
        // Show notification
        .to('#alert-notification', { opacity: 1, y: 0, duration: 0.5, ease: "back.out(1.5)" }, "+=0.5")
        // Success state
        .to('#alert-btn-text', { text: "¡Enviado!", duration: 0.1 }, "+=0.3")
        .to('#alert-send-btn', { backgroundColor: '#10B981', duration: 0.3 }, "<");
    }

    ScrollTrigger.create({
      trigger: '[data-demo="alerts"]',
      start: 'top 80%',
      onEnter: playAlertsDemo,
      onLeaveBack: () => alertsTL?.kill()
    });

    // =====================
    // HEADER & BLOCKS FADE-IN
    // =====================
    gsap.fromTo('[data-features-header]', 
      { y: 30, opacity: 0 },
      { 
        y: 0, 
        opacity: 1, 
        duration: 0.8, 
        ease: "power2.out",
        scrollTrigger: {
          trigger: '[data-features-header]',
          start: 'top 85%'
        }
      }
    );

    gsap.utils.toArray('.feature-block').forEach((block) => {
      gsap.fromTo(block as Element, 
        { y: 40, opacity: 0 },
        { 
          y: 0, 
          opacity: 1, 
          duration: 0.8, 
          ease: "power2.out",
          scrollTrigger: {
            trigger: block as Element,
            start: 'top 85%'
          }
        }
      );
    });
  }
</script>
